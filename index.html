<!DOCTYPE html>
<html>
<head>
  <title>ESP32 Live Light Control + Voice</title>
</head>
<body>
  <h2>ESP32 Light Control (Live + Voice)</h2>

  <h3>Light Status: <span id="status">Loading...</span></h3>

  <button onclick="turnOn()">Turn ON</button>
  <button onclick="turnOff()">Turn OFF</button>
  <br><br>

  <!-- ðŸŽ¤ Voice recognition button -->
  <button onclick="startListening()">ðŸŽ¤ Voice Control</button>
  <p id="voiceText" style="font-weight:bold;"></p>

  <!-- Firebase Scripts -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

  <script>
    // ðŸ”¥ Your Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyBrPt4qMRJJVogs-qfLExlhpJ3vACONI60",
      authDomain: "esp32check-d113e.firebaseapp.com",
      databaseURL: "https://esp32check-d113e-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "esp32check-d113e",
      storageBucket: "esp32check-d113e.firebasestorage.app",
      messagingSenderId: "203490926130",
      appId: "1:203490926130:web:08aef09c5efa69fe6c262b",
      measurementId: "G-VEK3FG924C"
    };

    // Initialize Firebase
    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const statusText = document.getElementById("status");
    const voiceText = document.getElementById("voiceText");

    // LIVE status listener
    db.ref("devices/devices001/light_state").on("value", (snapshot) => {
      const value = snapshot.val();
      statusText.textContent = value;

      if (value === "ON") {
        statusText.style.color = "green";
      } else {
        statusText.style.color = "red";
      }
    });

    // ON/OFF button functions
    function turnOn() {
      db.ref("devices/devices001/light_state").set("ON");
    }

    function turnOff() {
      db.ref("devices/devices001/light_state").set("OFF");
    }

    // ðŸŽ¤ Voice Recognition
    function startListening() {
      if (!('webkitSpeechRecognition' in window)) {
        alert("Speech Recognition not supported on this browser. Use Chrome.");
        return;
      }

      const recognition = new webkitSpeechRecognition();
      recognition.lang = "en-US";
      recognition.interimResults = false;
      recognition.maxAlternatives = 1;

      voiceText.innerText = "Listening... ðŸŽ§";

      recognition.start();

      recognition.onresult = function(event) {
        const spoken = event.results[0][0].transcript.toLowerCase();
        voiceText.innerText = "You said: " + spoken;

        if (spoken.includes("on")) {
          turnOn();
        }
        else if (spoken.includes("off")) {
          turnOff();
        }
        else {
          voiceText.innerText += " (command not recognized)";
        }
      };

      recognition.onerror = function(event) {
        voiceText.innerText = "Error: " + event.error;
      };
    }
  </script>
</body>
</html>
